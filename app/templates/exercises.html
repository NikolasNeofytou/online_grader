<!DOCTYPE html>
<html>
<head>
    <title>Exercises</title>
    <style>
        #editor { width: 100%; height: 300px; border: 1px solid #ccc; }
        textarea { display: none; }
        pre { background: #eee; padding: 10px; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/ext-language_tools.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/snippets/c_cpp.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        hljs.highlightAll();
        var editor = ace.edit('editor');
        editor.session.setMode('ace/mode/c_cpp');
        editor.setTheme('ace/theme/textmate');
        editor.setOptions({
          enableBasicAutocompletion: true,
          enableSnippets: true
        });
        var textarea = document.querySelector('textarea[name="code"]');
        editor.session.setValue(textarea.value || '');
        document.querySelector('form').addEventListener('submit', function() {
          textarea.value = editor.getValue();
        });
      });
    </script>
</head>
<body>
    <h1>Exercises</h1>
    <nav>
        <ul>
        {% for ex in exercises %}
            <li><a href="{{ url_for('exercises_view', id=loop.index0) }}">{{ ex.title }}</a></li>
        {% endfor %}
        </ul>
    </nav>
    <h2>{{ exercise.title }}</h2>
    <p>{{ exercise.description }}</p>

    <form method="post">
        <div id="editor">{{ code }}</div>
        <textarea name="code" id="code">{{ code }}</textarea>
        <br>
        <button type="submit">Run</button>
    </form>

    {% if result %}
    <h3>Result</h3>
    <pre><code class="language-text">{{ result }}</code></pre>
    {% endif %}

    {% if show_solution %}
    <h3>Solution</h3>
    <pre><code class="language-cpp">{{ exercise.solution_code }}</code></pre>
    {% else %}
    <p>Attempts: {{ attempts }} (solution available after 3 attempts)</p>
    {% endif %}
</body>
</html>
