<!DOCTYPE html>
<html>
<head>
    <title>Exercises</title>
    <style>
        textarea { width: 100%; height: 300px; }
        pre { background: #eee; padding: 10px; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        hljs.highlightAll();
        var t = document.querySelector('textarea[name="code"]');
        if (!t) return;
        t.addEventListener('keydown', function(e) {
          if (e.key === 'Tab') {
            e.preventDefault();
            var start = this.selectionStart;
            this.value = this.value.substring(0, start) + '    ' + this.value.substring(this.selectionEnd);
            this.selectionStart = this.selectionEnd = start + 4;
          } else if (e.key === 'Enter') {
            var start = this.selectionStart;
            var before = this.value.substring(0, start);
            var prev = before.substring(before.lastIndexOf('\n') + 1);
            var indent = prev.match(/^\s+/);
            indent = indent ? indent[0] : '';
            if (/\{\s*$/.test(prev)) indent += '    ';
            e.preventDefault();
            var insert = '\n' + indent;
            this.value = before + insert + this.value.substring(this.selectionEnd);
            this.selectionStart = this.selectionEnd = start + insert.length;
          }
        });
      });
    </script>
</head>
<body>
    <h1>Exercises</h1>
    <nav>
        <ul>
        {% for ex in exercises %}
            <li><a href="{{ url_for('exercises_view', id=loop.index0) }}">{{ ex.title }}</a></li>
        {% endfor %}
        </ul>
    </nav>
    <h2>{{ exercise.title }}</h2>
    <p>{{ exercise.description }}</p>

    <form method="post">
        <textarea name="code" placeholder="Enter your C++ code here">{{ code }}</textarea>
        <br>
        <button type="submit">Run</button>
    </form>

    {% if result %}
    <h3>Result</h3>
    <pre><code class="language-text">{{ result }}</code></pre>
    {% endif %}

    {% if show_solution %}
    <h3>Solution</h3>
    <pre><code class="language-cpp">{{ exercise.solution_code }}</code></pre>
    {% else %}
    <p>Attempts: {{ attempts }} (solution available after 3 attempts)</p>
    {% endif %}
</body>
</html>
